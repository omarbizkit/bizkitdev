---
export interface Props {
  techStack: string[];
  limit?: number;
  showNames?: boolean;
}

const { techStack, limit, showNames = false } = Astro.props;
const displayTechs = limit ? techStack.slice(0, limit) : techStack;
const remainingCount = limit && techStack.length > limit ? techStack.length - limit : 0;

const getTechIcon = (tech: string) => {
  const techLower = tech.toLowerCase();
  
  const iconMap: Record<string, string> = {
    // Languages
    'python': 'ğŸ',
    'javascript': 'ğŸŸ¨',
    'typescript': 'ğŸ”·',
    'java': 'â˜•',
    'c++': 'âš¡',
    'rust': 'ğŸ¦€',
    'go': 'ğŸ¹',
    'php': 'ğŸ˜',
    'ruby': 'ğŸ’',
    'swift': 'ğŸ¦',
    'kotlin': 'ğŸ¯',
    
    // Frameworks & Libraries
    'react': 'âš›ï¸',
    'vue': 'ğŸ’š',
    'angular': 'ğŸ…°ï¸',
    'svelte': 'ğŸ§¡',
    'astro': 'ğŸš€',
    'next.js': 'â–²',
    'nextjs': 'â–²',
    'nuxt': 'ğŸ’š',
    'express': 'ğŸŸ¢',
    'fastapi': 'âš¡',
    'flask': 'ğŸŒ¶ï¸',
    'django': 'ğŸ¸',
    'spring': 'ğŸŒ±',
    'laravel': 'ğŸ­',
    'rails': 'ğŸš‚',
    
    // AI/ML
    'tensorflow': 'ğŸ§ ',
    'pytorch': 'ğŸ”¥',
    'scikit-learn': 'ğŸ“Š',
    'pandas': 'ğŸ¼',
    'numpy': 'ğŸ”¢',
    'opencv': 'ğŸ‘ï¸',
    'transformers': 'ğŸ¤–',
    'spacy': 'ğŸ“',
    'mlflow': 'ğŸ”„',
    
    // Databases
    'postgresql': 'ğŸ˜',
    'mongodb': 'ğŸƒ',
    'redis': 'ğŸ”´',
    'mysql': 'ğŸ¬',
    'sqlite': 'ğŸ“¦',
    'influxdb': 'ğŸ“ˆ',
    
    // Cloud & DevOps
    'docker': 'ğŸ³',
    'kubernetes': 'â˜¸ï¸',
    'aws': 'â˜ï¸',
    'azure': 'â˜ï¸',
    'gcp': 'â˜ï¸',
    'aws iot': 'ğŸ“¡',
    'nginx': 'ğŸ”§',
    
    // Tools & Platforms
    'git': 'ğŸ“‹',
    'webpack': 'ğŸ“¦',
    'vite': 'âš¡',
    'node.js': 'ğŸŸ¢',
    'nodejs': 'ğŸŸ¢',
    'websocket': 'ğŸ”Œ',
    'rest api': 'ğŸŒ',
    'graphql': 'ğŸ”—',
    'mqtt': 'ğŸ“¡',
    'webassembly': 'âš™ï¸',
    
    // Hardware & IoT
    'arduino': 'ğŸ”Œ',
    'raspberry pi': 'ğŸ¥§',
    'nvidia': 'ğŸ’š',
    'cuda': 'ğŸš€',
    
    // Blockchain
    'ethereum': 'ğŸ’',
    'web3': 'ğŸŒ',
    'blockchain': 'â›“ï¸',
    
    // Data & Analytics
    'chart.js': 'ğŸ“Š',
    'd3.js': 'ğŸ“ˆ',
    'grafana': 'ğŸ“Š',
    'prometheus': 'ğŸ”',
    
    // Testing
    'jest': 'ğŸƒ',
    'cypress': 'ğŸŒ²',
    'playwright': 'ğŸ­',
    'vitest': 'âš¡',
    
    // Other
    'cmake': 'ğŸ”¨',
    'openmp': 'ğŸ”„',
    'three.js': 'ğŸ®',
    'tailwind': 'ğŸ’¨',
    'sass': 'ğŸ¨',
    'linear algebra': 'ğŸ“',
    'complex numbers': 'ğŸ”¢'
  };
  
  // Try exact match first
  if (iconMap[techLower]) {
    return iconMap[techLower];
  }
  
  // Try partial matches for compound names
  for (const [key, icon] of Object.entries(iconMap)) {
    if (techLower.includes(key) || key.includes(techLower)) {
      return icon;
    }
  }
  
  // Default icon for unknown tech
  return 'âš™ï¸';
};
---

<div class="flex flex-wrap items-center gap-2" role="list" aria-label="Technologies used">
  {displayTechs.map((tech) => (
    <div 
      class={`inline-flex items-center gap-1.5 px-2 py-1 rounded-md text-sm font-medium bg-gray-800/50 border border-gray-700/50 text-gray-300 hover:border-cyan-400/50 transition-colors ${showNames ? '' : 'tooltip-container'}`}
      role="listitem"
      title={showNames ? undefined : tech}
    >
      <span class="text-base" aria-hidden="true">{getTechIcon(tech)}</span>
      {showNames && <span>{tech}</span>}
      {!showNames && (
        <span class="sr-only">{tech}</span>
      )}
    </div>
  ))}
  {remainingCount > 0 && (
    <div 
      class="inline-flex items-center gap-1.5 px-2 py-1 rounded-md text-sm font-medium bg-gray-700/50 border border-gray-600/50 text-gray-400"
      title={`${remainingCount} more technologies`}
    >
      <span>+{remainingCount}</span>
    </div>
  )}
</div>

<style>
.tooltip-container {
  position: relative;
}

.tooltip-container:hover::after {
  content: attr(title);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  padding: 0.5rem 0.75rem;
  background: rgb(17 24 39);
  border: 1px solid rgb(75 85 99);
  border-radius: 0.375rem;
  font-size: 0.875rem;
  white-space: nowrap;
  z-index: 50;
  opacity: 1;
  pointer-events: none;
  margin-bottom: 0.25rem;
}

.tooltip-container::after {
  content: '';
  opacity: 0;
  transition: opacity 0.2s;
}
</style>